# Cognitive Dungeon: Backend (Go)

–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ **Cognitive Dungeon** ‚Äî —Ç–µ–∫—Å—Ç–æ–≤–æ–π –æ–Ω–ª–∞–π–Ω RPG —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º –ò–ò, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–æ–ª–µ–≤—ã—Ö –∏–≥—Ä. –°–µ—Ä–≤–µ—Ä –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ **Go** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **WebSockets** –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–µ—Ä–≤–µ—Ä –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö "–∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞", –≥–¥–µ –≤—Å—è –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –∏ —Ñ–∏–∑–∏–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ, –∞ –∫–ª–∏–µ–Ω—Ç—ã –≤—ã—Å—Ç—É–ø–∞—é—Ç –≤ —Ä–æ–ª–∏ —Ç–æ–Ω–∫–∏—Ö –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤. –ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:

-   **–ï–¥–∏–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä —Å—É—â–Ω–æ—Å—Ç–µ–π (Unified Entity Registry):** –í –∏–≥—Ä–µ –Ω–µ—Ç –∂–µ—Å—Ç–∫–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ "–∏–≥—Ä–æ–∫–∞" –∏ "NPC". –í—Å–µ –∞–∫—Ç–æ—Ä—ã (–≥–µ—Ä–æ–∏, –º–æ–Ω—Å—Ç—Ä—ã, —Å–æ—é–∑–Ω–∏–∫–∏) —è–≤–ª—è—é—Ç—Å—è `Entity` –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–±—â–µ–º —Å–ø–∏—Å–∫–µ `GameService.Entities`. –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –ª–æ–≥–∏–∫—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞.

-   **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏ (Dynamic Agent Control):** –°—É—â–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫–æ–º, —Ç–∞–∫ –∏ –ò–ò. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç "–Ω–∞ –ª–µ—Ç—É":
    -   –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket –∏ "–∑–∞–≤–ª–∞–¥–µ–≤–∞–µ—Ç" —Å—É—â–Ω–æ—Å—Ç—å—é –ø–æ –µ—ë ID, –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —ç—Ç—É —Å—É—â–Ω–æ—Å—Ç—å –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥ –æ—Ç —á–µ–ª–æ–≤–µ–∫–∞.
    -   –ï—Å–ª–∏ –æ—Ç —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –≤ `Hub`), –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –µ—ë —Ö–æ–¥ —Å –ø–æ–º–æ—â—å—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –ò–ò.
    -   –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–≥—Ä–æ–∫–∞–º –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∏ –æ—Ç–∫–ª—é—á–∞—Ç—å—Å—è –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∏—Ä–∞, –∞ —Ç–∞–∫–∂–µ –¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏—Ö –±–æ—Ç–æ–≤-–∞–≥–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ –∏–≥—Ä–æ–∫–∏.

-   **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (ECS-like):** –°—É—â–Ω–æ—Å—Ç–∏ (`Entity`) —Å–æ—Å—Ç–æ—è—Ç –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (`StatsComponent`, `AIComponent`, `RenderComponent` –∏ —Ç.–¥.), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∏—Ö –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ —Å–≤–æ–π—Å—Ç–≤–∞.

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
-   **–Ø–∑—ã–∫:** Go (Golang) 1.22+
-   **–ü—Ä–æ—Ç–æ–∫–æ–ª:** JSON over WebSockets
-   **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:** `gorilla/websocket`

## üöÄ –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

1.  **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Go:** [–°–∫–∞—á–∞—Ç—å Go](https://go.dev/dl/)
2.  **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
    ```bash
    git clone https://github.com/Cognitive-Dungeon/cd-backend-go.git
    cd cd-backend-go
    ```
3.  **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
    ```bash
    go mod tidy
    ```
4.  **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
    ```bash
    go run cmd/server/main.go
    ```
    *–í—ã —É–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: `üõ°Ô∏è Cognitive Dungeon Server running on :8080`*

## üîå API (WebSocket)

**–ê–¥—Ä–µ—Å:** `ws://localhost:8080/ws`

–ü—Ä–æ—Ç–æ–∫–æ–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∏ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ JSON-—Å–æ–æ–±—â–µ–Ω–∏—è—Ö.

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ "–ó–∞–≤–ª–∞–¥–µ–Ω–∏–µ" (Handshake)

–°—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –∫–ª–∏–µ–Ω—Ç –î–û–õ–ñ–ï–ù –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å—É—â–Ω–æ—Å—Ç–∏ –≤ –∏–≥—Ä–æ–≤–æ–º –º–∏—Ä–µ.

**–ö–ª–∏–µ–Ω—Ç -> –°–µ—Ä–≤–µ—Ä:**
```json
{
  "action": "LOGIN",
  "token": "hero_1" 
}
```
-   `token`: –≠—Ç–æ `ID` —Å—É—â–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä–æ–π –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å. –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–∑–¥–∞–µ—Ç—Å—è –≥–µ—Ä–æ–π —Å ID `hero_1`.

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –º–∏—Ä–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ "–ª–æ–≥–∏–Ω–∞" —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –ø—Ä–∏—Å—ã–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞ `UPDATE` –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç —Ö–æ–¥ –¥–∞–Ω–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏. –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π —Å–ª–µ–ø–æ–∫ –º–∏—Ä–∞, –≤–∏–¥–∏–º–æ–≥–æ –¥–ª—è —ç—Ç–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.

**–°–µ—Ä–≤–µ—Ä -> –ö–ª–∏–µ–Ω—Ç:**
```json
{
  "type": "UPDATE",
  "tick": 1250,
  "myEntityId": "hero_1",
  "activeEntityId": "hero_1",
  "grid": { "w": 40, "h": 25 },
  "map": [
    { "x": 10, "y": 15, "symbol": ".", "color": "#333", "isWall": false, "isVisible": true, "isExplored": true }
  ],
  "entities": [
    {
      "id": "hero_1",
      "type": "PLAYER",
      "name": "–ì–µ—Ä–æ–π",
      "pos": { "x": 10, "y": 15 },
      "render": { "symbol": "@", "color": "#22D3EE" },
      "stats": { "hp": 100, "maxHp": 100, "stamina": 100, "maxStamina": 100, "gold": 50, "strength": 10, "isDead": false }
    },
    {
      "id": "e_2",
      "type": "ENEMY",
      "name": "–•–∏—Ç—Ä—ã–π –ì–æ–±–ª–∏–Ω",
      "pos": { "x": 12, "y": 15 },
      "render": { "symbol": "g", "color": "#22C55E" },
      "stats": { "hp": 17, "maxHp": 17, "isDead": false }
    }
  ],
  "logs": [
    { "id": "...", "text": "–ì–æ–±–ª–∏–Ω —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –≤–∞—Å.", "type": "INFO", "timestamp": ... }
  ]
}
```
-   `activeEntityId`: ID —Å—É—â–Ω–æ—Å—Ç–∏, —á–µ–π —Ö–æ–¥ —Å–µ–π—á–∞—Å. –ï—Å–ª–∏ –æ–Ω —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `myEntityId`, –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥

–ö–æ–≥–¥–∞ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç —Ö–æ–¥ –∏–≥—Ä–æ–∫–∞ (`activeEntityId == myEntityId`), –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—ã.

**–ö–ª–∏–µ–Ω—Ç -> –°–µ—Ä–≤–µ—Ä (–ü—Ä–∏–º–µ—Ä: –î–≤–∏–∂–µ–Ω–∏–µ):**
```json
{
  "action": "MOVE",
  "payload": {
    "dx": 1, 
    "dy": 0
  }
}
```
-   `token` –≤ –∫–æ–º–∞–Ω–¥–∞—Ö –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞, —Ç–∞–∫ –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä —É–∂–µ –∑–Ω–∞–µ—Ç, –∫—Ç–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º.

**–î—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:** `ATTACK`, `TALK` (—Ç—Ä–µ–±—É—é—Ç `targetId` –≤ `payload`), `WAIT`.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
-   `cmd/server/main.go`: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ WebSocket.
-   `internal/engine/`: –Ø–¥—Ä–æ –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏.
   -   `service.go`: –ì–ª–∞–≤–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —Å–µ—Ä–≤–∏—Å, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –∏–≥—Ä–æ–≤—ã–º —Ü–∏–∫–ª–æ–º (`Game Loop`).
   -   `handlers/`: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ (`MOVE`, `ATTACK` –∏ —Ç.–¥.).
-   `internal/domain/`: –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã (`Entity`, `GameWorld`, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã).
-   `internal/systems/`: –ß–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (stateless), —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ –∏–≥—Ä–æ–≤—É—é –º–µ—Ö–∞–Ω–∏–∫—É (—Ñ–∏–∑–∏–∫–∞, –±–æ–π, –ò–ò, –ø–æ–ª–µ –∑—Ä–µ–Ω–∏—è).
-   `internal/agent/`: –ü—Ä–∏–º–µ—Ä—ã "–∞–≥–µ–Ω—Ç–æ–≤" –∏–ª–∏ –±–æ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É.
-   `internal/network/`: –•–∞–± –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è WebSocket-–ø–æ–¥–ø–∏—Å–∫–∞–º–∏ (`Broadcaster`).
-   `pkg/`: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, –Ω–µ –∑–∞–≤–∏—Å—è—â–∏–µ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏ (–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥–∑–µ–º–µ–ª–∏–π, API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã).
-   `tools/`: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, –≤–∫–ª—é—á–∞—è –≤–µ–±-–∫–ª–∏–µ–Ω—Ç.


